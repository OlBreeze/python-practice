
# –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ 30 –¥–Ω—ñ–≤
üéØ **–í–∞–∂–ª–∏–≤–æ:** –°–∏–≥–Ω–∞–ª `post_save` —Å–∞–º –ø–æ —Å–æ–±—ñ –Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ 30 –¥–Ω—ñ–≤ - 
–ø–æ—Ç—Ä—ñ–±–µ–Ω –∑–æ–≤–Ω—ñ—à–Ω—ñ–π —Ç—Ä–∏–≥–µ—Ä (cron, celery –∞–±–æ —Ä—É—á–Ω–∏–π –∑–∞–ø—É—Å–∫ –∫–æ–º–∞–Ω–¥–∏)!
---

## ‚úÖ –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏

–Ñ **–¥–≤–∞ –ø—ñ–¥—Ö–æ–¥–∏** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –¥–µ–∞–∫—Ç–∏–≤–∞—Ü—ñ—ó:

### –ü—ñ–¥—Ö—ñ–¥ 1: –ß–µ—Ä–µ–∑ Celery (–∫—Ä–∞—â–∏–π –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É)
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –∑–∞–¥–∞—á—ñ

### –ü—ñ–¥—Ö—ñ–¥ 2: –ß–µ—Ä–µ–∑ Django management –∫–æ–º–∞–Ω–¥—É + cron
–ü—Ä–æ—Å—Ç—ñ—à–∏–π, –Ω–µ –ø–æ—Ç—Ä–µ–±—É—î –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤

**–£ –ø—Ä–æ—î–∫—Ç—ñ –≤–∂–µ —î:** Management –∫–æ–º–∞–Ω–¥–∞ `deactivate_expired_ads.py` ‚úÖ

---

## üìù –û–Ω–æ–≤–ª–µ–Ω–∏–π signals.py## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ –∑ —Ü–∏–º –ø—ñ–¥—Ö–æ–¥–æ–º

**–°–∏–≥–Ω–∞–ª `post_save` —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –¢–Ü–õ–¨–ö–ò –∫–æ–ª–∏:**
- –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ–≤–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è
- –†–µ–¥–∞–≥—É—î—Ç—å—Å—è —ñ—Å–Ω—É—é—á–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è

**–ù–ï —Å–ø—Ä–∞—Ü—å–æ–≤—É—î:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ 30 –¥–Ω—ñ–≤ (—è–∫—â–æ –Ω—ñ—Ö—Ç–æ –Ω–µ —Ä–µ–¥–∞–≥—É—î –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è)

---

## üéØ –ö—Ä–∞—â—ñ —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –¥–µ–∞–∫—Ç–∏–≤–∞—Ü—ñ—ó

### ‚úÖ –†—ñ—à–µ–Ω–Ω—è 1: Management –∫–æ–º–∞–Ω–¥–∞ + Cron (–†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–û)

**–£ –≤–∞—Å –≤–∂–µ —î –∫–æ–º–∞–Ω–¥–∞:** `board/management/commands/deactivate_expired_ads.py`

#### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Windows Task Scheduler:

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ **Task Scheduler** (–ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –∑–∞–≤–¥–∞–Ω—å)
2. Create Basic Task
3. Name: "Deactivate Expired Ads"
4. Trigger: Daily, 3:00 AM
5. Action: Start a program
6. Program: `C:\Python\python.exe`
7. Arguments: `C:\path\to\project\manage.py deactivate_expired_ads`

#### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Linux Cron:

```bash
# –í—ñ–¥–∫—Ä–∏–π—Ç–µ crontab
crontab -e

# –î–æ–¥–∞–π—Ç–µ —Ä—è–¥–æ–∫ (–≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —â–æ–¥–Ω—è –æ 3:00)
0 3 * * * cd /path/to/project && python manage.py deactivate_expired_ads
```

---

### ‚úÖ –†—ñ—à–µ–Ω–Ω—è 2: Celery Beat (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É)

–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Celery:
```bash
pip install celery redis
```---

### ‚úÖ –†—ñ—à–µ–Ω–Ω—è 3: –°–∏–≥–Ω–∞–ª –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ (–ø—Ä–æ—Å—Ç—ñ—à–∏–π)

–î–æ–¥–∞—Ç–∏ —Å–∏–≥–Ω–∞–ª, —è–∫–∏–π –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ:---

## üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø—ñ–¥—Ö–æ–¥—ñ–≤

| –ü—ñ–¥—Ö—ñ–¥ | –ü–ª—é—Å–∏ | –ú—ñ–Ω—É—Å–∏ | –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å |
|--------|-------|--------|------------|
| **–°–∏–≥–Ω–∞–ª post_save** | –ü—Ä–æ—Å—Ç–æ | –ù–µ –ø—Ä–∞—Ü—é—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ | ‚≠ê |
| **Management –∫–æ–º–∞–Ω–¥–∞ + Cron** | –ù–∞–¥—ñ–π–Ω–æ, –ø—Ä–æ—Å—Ç–æ | –¢—Ä–µ–±–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ cron | ‚≠ê‚≠ê |
| **Celery Beat** | –ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ, –≥–Ω—É—á–∫–æ | –ü–æ—Ç—Ä–µ–±—É—î Redis/RabbitMQ | ‚≠ê‚≠ê‚≠ê‚≠ê |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è –¥–ª—è –≤–∞—à–æ–≥–æ –ø—Ä–æ—î–∫—Ç—É

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —ñ—Å–Ω—É—é—á—É –∫–æ–º–∞–Ω–¥—É (–Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–µ)

**–ó–∞–ø—É—Å–∫–∞—Ç–∏ –≤—Ä—É—á–Ω—É:**
```bash
python manage.py deactivate_expired_ads
```

**–ê–±–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ Windows Task Scheduler:**
1. –°—Ç–≤–æ—Ä—ñ—Ç—å `.bat` —Ñ–∞–π–ª:2. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ Task Scheduler –∑–∞–ø—É—Å–∫–∞—Ç–∏ —Ü–µ–π —Ñ–∞–π–ª —â–æ–¥–Ω—è

---

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –î–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –ø—Ä–∏ –ø–µ—Ä–µ–≥–ª—è–¥—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è

–£ `views.py`:

```python
def ad_detail(request, ad_id):
    ad = get_object_or_404(Ad, id=ad_id)
    
    # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –Ω–µ –∑–∞—Å—Ç–∞—Ä—ñ–ª–µ
    ad.deactivate_if_expired()
    ad.refresh_from_db()  # –û–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ
    
    # –†–µ—à—Ç–∞ –∫–æ–¥—É...
```

---

## üìã –ü—ñ–¥—Å—É–º–æ–∫

### –©–æ —î –∑–∞—Ä–∞–∑:
- ‚úÖ Management –∫–æ–º–∞–Ω–¥–∞ `deactivate_expired_ads.py`
- ‚úÖ –ú–µ—Ç–æ–¥ –º–æ–¥–µ–ª—ñ `deactivate_if_expired()`
- ‚ö†Ô∏è **–í—ñ–¥—Å—É—Ç–Ω—ñ–π:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞–ø—É—Å–∫

### –©–æ –¥–æ–¥–∞–≤:
1. ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–∏–π `signals.py` –∑ —Å–∏–≥–Ω–∞–ª–æ–º –¥–µ–∞–∫—Ç–∏–≤–∞—Ü—ñ—ó ‚Üí [signals_with_deactivation.py](computer:///mnt/user-data/outputs/signals_with_deactivation.py)
2. ‚úÖ –ü—Ä–∏–∫–ª–∞–¥ Celery –∑–∞–¥–∞—á—ñ ‚Üí [celery_tasks_example.py](computer:///mnt/user-data/outputs/celery_tasks_example.py)
3. ‚úÖ Bat —Ñ–∞–π–ª –¥–ª—è Windows ‚Üí [run_deactivation.bat](computer:///mnt/user-data/outputs/run_deactivation.bat)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:
**–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Management –∫–æ–º–∞–Ω–¥—É + Task Scheduler/Cron** ‚≠ê

–¶–µ –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–µ —ñ –Ω–∞–π–Ω–∞–¥—ñ–π–Ω—ñ—à–µ —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è –≤–∞—à–æ–≥–æ –ø—Ä–æ—î–∫—Ç—É!

```bash
# –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —â–æ–¥–Ω—è:
python manage.py deactivate_expired_ads
```

